Skip to content
Navigation Menu
helbertbarbosa07
vendas_chopp

Type / to search
Code
Issues
Pull requests
Actions
Projects
Wiki
Security
Insights
Settings
Commit 87f136f
helbertbarbosa07
helbertbarbosa07
authored
1 hour ago
·
·
Verified
Update index.html
main
1 parent 
a63ab46
 commit 
87f136f
File tree
Filter files…
index.html
1 file changed
+25
-37
lines changed
Search within code
 
‎index.html‎
+25
-37
Lines changed: 25 additions & 37 deletions
Original file line number	Diff line number	Diff line change
@@ -2736,45 +2736,33 @@ <h3 style="font-size: 18px; font-weight: 800; margin-bottom: 8px; color: var(--d
// ===== ESTATÍSTICAS =====
async function updateStatistics() {
    try {
        // Atualizar do localStorage primeiro
        document.getElementById("totalProducts").textContent = produtos.length;
        document.getElementById("totalSales").textContent = vendas.length;
        
        const totalRevenue = vendas.reduce((sum, v) => sum + (v.total || 0), 0);
        document.getElementById("totalRevenue").textContent = `R$ ${formatPrice(totalRevenue)}`;
        
        // Tentar atualizar do Neon se estiver online
        if (dbOnline) {
            try {
                const response = await fetch("/api/neon", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        sql: `
                            SELECT 
                              (SELECT COUNT(*) FROM produtos) AS total_produtos,
                              (SELECT COUNT(*) FROM vendas) AS total_vendas,
                              (SELECT COALESCE(SUM(total),0) FROM vendas) AS faturamento
                        `
                    })
                });
                const result = await response.json();
                if (result.success) {
                    const data = result.rows[0];
                    document.getElementById("totalProducts").textContent = data.total_produtos;
                    document.getElementById("totalSales").textContent = data.total_vendas;
                    document.getElementById("totalRevenue").textContent = `R$ ${formatPrice(data.faturamento)}`;
                }
            } catch (err) {
                console.log("Usando dados locais para estatísticas");
            }
        }
        const res = await fetch('/api/neon', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                sql: `
                    SELECT
                        (SELECT COUNT(*) FROM produtos) AS total_produtos,
                        (SELECT COUNT(*) FROM vendas) AS total_vendas,
                        (SELECT COALESCE(SUM(total), 0) FROM vendas) AS faturamento
                `
            })
        });
        const data = await res.json();
        if (!data.success) throw new Error('Erro Neon');
        const stats = data.rows[0];
        document.getElementById('totalProducts').innerText = stats.total_produtos;
        document.getElementById('totalSales').innerText = stats.total_vendas;
        document.getElementById('totalRevenue').innerText =
            'R$ ' + Number(stats.faturamento).toFixed(2);
    } catch (err) {
        console.error("Erro ao atualizar estatísticas:", err);
        console.error('Erro updateStatistics:', err);
    }
}
};

// ===== GRÁFICOS =====
function updateCharts() {
0 commit comments
Comments
0
 (0)
Comment
You're not receiving notifications from this thread.

 
api content loaded
