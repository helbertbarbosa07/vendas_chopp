<!DOCTYPE html>
<html lang="pt-BR"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üç¶ Chop Manager PRO - Sistema Completo TESTW</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* ===== VARI√ÅVEIS E RESET ===== */
        :root {
            --primary: #36B5B0;
            --secondary: #FF7BAC;
            --accent: #FFD166;
            --dark: #2A2D43;
            --light: #F8F9FA;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
            --gray: #6c757d;
            --shadow: 0 5px 15px rgba(0,0,0,0.1);
            --radius: 15px;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        /* ===== LAYOUT PRINCIPAL ===== */
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 25px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            overflow: hidden;
            min-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, var(--primary), #2A9D8F);
            color: white;
            padding: 25px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 5px solid var(--secondary);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: 'üç¶üç®üçß';
            position: absolute;
            font-size: 60px;
            opacity: 0.1;
            right: 30px;
            top: 10px;
            transform: rotate(-15deg);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo-icon {
            font-size: 45px;
            animation: float 3s ease-in-out infinite;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .logo-text h1 {
            font-size: 32px;
            font-weight: 800;
            letter-spacing: 1px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .logo-text span {
            color: var(--accent);
            font-weight: 900;
        }
        
        /* ===== NAVEGA√á√ÉO ===== */
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid var(--primary);
            padding: 0 20px;
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 20px 25px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 700;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
            white-space: nowrap;
        }
        
        .nav-tab:hover {
            color: var(--dark);
            background: rgba(54, 181, 176, 0.1);
        }
        
        .nav-tab.active {
            color: var(--primary);
            background: white;
        }
        
        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--secondary);
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: scaleX(0); }
            to { transform: scaleX(1); }
        }
        
        /* ===== CONTE√öDO ===== */
        .main-content {
            flex: 1;
            padding: 30px;
            background: #f9f9f9;
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ===== FORMAS DE PAGAMENTO ===== */
        .payment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .payment-option {
            position: relative;
            cursor: pointer;
        }
        
        .payment-option input {
            display: none;
        }
        
        .payment-card {
            background: white;
            border: 3px solid #dee2e6;
            border-radius: 15px;
            padding: 25px 20px;
            text-align: center;
            transition: var(--transition);
        }
        
        .payment-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            border-color: var(--primary);
        }
        
        .payment-option input:checked + .payment-card {
            border-color: var(--success);
            background: linear-gradient(135deg, #f8fff9, #e8f5e9);
            transform: scale(1.05);
            box-shadow: 0 15px 30px rgba(76, 175, 80, 0.2);
        }
        
        .payment-icon {
            font-size: 40px;
            margin-bottom: 15px;
            display: block;
        }
        
        .payment-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--dark);
        }
        
        /* ===== PERSONALIZA√á√ÉO DE EMOJI ===== */
        .emoji-picker {
            position: absolute;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 15px;
            z-index: 100;
            display: none;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            max-width: 300px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .emoji-picker.show {
            display: grid;
        }
        
        .emoji-option {
            font-size: 24px;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
        }
        
        .emoji-option:hover {
            background: #f0f0f0;
            transform: scale(1.2);
        }
        
        .emoji-selected {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-top: 10px;
        }
        
        .emoji-selected span {
            font-size: 30px;
        }
        
        /* ===== BOT√ïES ===== */
        .export-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .export-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
        }
        
        .export-btn.print {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }
        
        .export-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        /* ===== NOTIFICA√á√ïES ===== */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 20px 30px;
            border-radius: 15px;
            color: white;
            font-weight: 700;
            z-index: 2000;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            display: none;
            animation: slideInRight 0.5s ease-out;
            max-width: 400px;
            backdrop-filter: blur(10px);
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .notification.show {
            display: block;
        }
        
        .notification.success {
            background: linear-gradient(135deg, var(--success), #3d8b40);
        }
        
        .notification.error {
            background: linear-gradient(135deg, var(--danger), #d32f2f);
        }
        
        .notification.info {
            background: linear-gradient(135deg, var(--primary), #2A9D8F);
        }
        
        /* ===== RESPONSIVIDADE ===== */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
                padding: 20px;
            }
            
            .nav-tabs {
                overflow-x: auto;
                padding: 0 10px;
            }
            
            .nav-tab {
                padding: 15px 20px;
                font-size: 14px;
                white-space: nowrap;
            }
            
            .payment-options {
                grid-template-columns: 1fr;
            }
            
            .export-buttons {
                flex-direction: column;
            }
            
            .export-btn {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* ===== ESTILOS B√ÅSICOS ===== */
        .page-title {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .page-title i {
            font-size: 32px;
            color: var(--primary);
            background: rgba(54, 181, 176, 0.1);
            padding: 15px;
            border-radius: 50%;
        }
        
        .page-title h2 {
            font-size: 32px;
            color: var(--dark);
            font-weight: 800;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            border-top: 5px solid var(--primary);
            transition: var(--transition);
            position: relative;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }
        
        .flavors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .flavor-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            border: 3px solid transparent;
        }
        
        .flavor-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            border-color: var(--primary);
        }
        
        .cart-container {
            background: white;
            border-radius: 25px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-top: 30px;
        }
        
        .btn-primary {
            padding: 15px 30px;
            background: linear-gradient(135deg, var(--primary), #2A9D8F);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(54, 181, 176, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(54, 181, 176, 0.4);
        }
        
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: white;
            border-radius: 25px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 30px 60px rgba(0,0,0,0.4);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: var(--dark);
            font-size: 16px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 16px;
            transition: var(--transition);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(54, 181, 176, 0.1);
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            background: var(--dark);
            color: white;
            font-size: 14px;
            border-top: 5px solid var(--primary);
        }
        
        /* ===== ESTILOS PARA √öLTIMAS VENDAS ===== */
        .recent-sales-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-top: 30px;
        }
        
        .sales-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .sales-header h3 {
            color: var(--dark);
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sales-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .sales-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            color: var(--dark);
            font-weight: 700;
            border-bottom: 2px solid var(--primary);
            font-size: 14px;
        }
        
        .sales-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }
        
        .sales-table tr:hover {
            background: #f8f9fa;
        }
        
        .payment-badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 700;
            display: inline-block;
        }
        
        .payment-dinheiro {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .payment-cartao {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .payment-pix {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        
        .empty-sales {
            text-align: center;
            padding: 30px 20px;
            color: var(--gray);
        }
        
        .empty-sales i {
            font-size: 40px;
            margin-bottom: 10px;
            opacity: 0.3;
        }
        
        /* ===== ESTILOS PARA FOTO DO PRODUTO ===== */
        .photo-upload-container {
            border: 2px dashed #dee2e6;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 15px;
        }
        
        .photo-upload-container:hover {
            border-color: var(--primary);
            background: rgba(54, 181, 176, 0.05);
        }
        
        .photo-preview {
            max-width: 150px;
            max-height: 150px;
            border-radius: 10px;
            object-fit: cover;
            margin-bottom: 10px;
            display: none;
        }
        
        .photo-preview.show {
            display: block;
        }
        
        .upload-icon {
            font-size: 40px;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        /* ===== ESTILOS PARA PRODUTOS MAIS VENDIDOS ===== */
        .top-products-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-top: 30px;
        }
        
        .top-products-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .top-product-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 15px;
            transition: var(--transition);
        }
        
        .top-product-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .top-product-emoji {
            font-size: 30px;
            margin-right: 15px;
        }
        
        .top-product-info {
            flex: 1;
        }
        
        .top-product-name {
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .top-product-stats {
            display: flex;
            justify-content: space-between;
            color: var(--gray);
            font-size: 12px;
        }
        
        .top-product-rank {
            width: 25px;
            height: 25px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 12px;
            margin-left: 10px;
        }
        
        /* ===== ESTILOS PARA ESTOQUE BAIXO ===== */
        .low-stock-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow);
            margin-top: 30px;
            border: 2px solid var(--warning);
        }
        
        .low-stock-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .low-stock-item {
            background: #fff3cd;
            border-radius: 15px;
            padding: 15px;
            display: flex;
            align-items: center;
            transition: var(--transition);
        }
        
        .low-stock-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.2);
        }
        
        .low-stock-emoji {
            font-size: 25px;
            margin-right: 10px;
        }
        
        .low-stock-info {
            flex: 1;
        }
        
        .low-stock-name {
            font-weight: 700;
            color: #856404;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .low-stock-quantity {
            color: #856404;
            font-size: 12px;
        }
        
        .warning-icon {
            color: var(--warning);
            font-size: 18px;
            margin-left: 10px;
        }
        
        /* ===== ESTILOS PARA GRID DE DASHBOARD ===== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        @media (max-width: 500px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* ===== LOADING ===== */
        .loading {
            text-align: center;
            padding: 50px;
            color: var(--gray);
        }
        
        .loading i {
            font-size: 40px;
            margin-bottom: 15px;
            color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- HEADER -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">üç¶</div>
                <div class="logo-text">
                    <h1>CHOP <span>MANAGER</span> PRO</h1>
                    <div style="font-size: 14px; opacity: 0.9;">Sistema Completo de Vendas</div>
                </div>
            </div>
            
            <div style="display: flex; align-items: center; gap: 20px;">
                <div class="day-info">
                    <div id="currentDate" style="font-size: 16px; margin-bottom: 5px;">Carregando...</div>
                    <div id="currentTime" style="font-size: 24px; font-weight: 800; color: var(--accent);">00:00:00</div>
                </div>
                
                <button onclick="syncData()" id="syncButton" style="
                    background: linear-gradient(135deg, var(--secondary), #FF4081);
                    color: white; 
                    border: none; 
                    border-radius: 12px; 
                    padding: 10px 18px; 
                    cursor: pointer; 
                    font-size: 13px; 
                    font-weight: 700;
                    display: flex; 
                    align-items: center; 
                    gap: 8px;
                    transition: var(--transition);
                    box-shadow: 0 4px 12px rgba(255, 123, 172, 0.3);
                    white-space: nowrap;
                    height: fit-content;">
                    <i class="fas fa-sync-alt"></i> Sincronizar
                </button>
            </div>
        </header>
        
        <!-- NAVEGA√á√ÉO -->
        <nav class="nav-tabs">
            <button class="nav-tab active" data-page="dashboard">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </button>
            <button class="nav-tab" data-page="vendas">
                <i class="fas fa-cash-register"></i> Vender
            </button>
            <button class="nav-tab" data-page="produtos">
                <i class="fas fa-ice-cream"></i> Produtos
            </button>
            <button class="nav-tab" data-page="fiados">
                <i class="fas fa-hand-holding-usd"></i> Fiados
            </button>
            <button class="nav-tab" data-page="relatorios">
                <i class="fas fa-chart-pie"></i> Relat√≥rios
            </button>
            <button class="nav-tab" data-page="config">
                <i class="fas fa-cog"></i> Configura√ß√µes
            </button>
        </nav>
        
        <!-- CONTE√öDO PRINCIPAL -->
        <main class="main-content">
            <!-- DASHBOARD -->
            <section id="dashboard" class="page active">
                <div class="page-title">
                    <i class="fas fa-tachometer-alt"></i>
                    <h2>Dashboard de Vendas</h2>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div style="font-size: 14px; color: var(--gray); margin-bottom: 10px;">Faturamento Hoje</div>
                        <div style="font-size: 32px; font-weight: 900; color: var(--dark);" id="todayRevenue">R$ 0,00</div>
                        <div style="position: absolute; right: 20px; top: 20px; font-size: 30px; opacity: 0.1;">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div style="font-size: 14px; color: var(--gray); margin-bottom: 10px;">Chops Vendidos</div>
                        <div style="font-size: 32px; font-weight: 900; color: var(--dark);" id="todayChops">0</div>
                        <div style="position: absolute; right: 20px; top: 20px; font-size: 30px; opacity: 0.1;">
                            <i class="fas fa-ice-cream"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div style="font-size: 14px; color: var(--gray); margin-bottom: 10px;">M√©dia por Venda</div>
                        <div style="font-size: 32px; font-weight: 900; color: var(--dark);" id="avgSale">R$ 0,00</div>
                        <div style="position: absolute; right: 20px; top: 20px; font-size: 30px; opacity: 0.1;">
                            <i class="fas fa-calculator"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div style="font-size: 14px; color: var(--gray); margin-bottom: 10px;">Estoque Baixo</div>
                        <div style="font-size: 32px; font-weight: 900; color: var(--dark);" id="lowStock">0</div>
                        <div style="position: absolute; right: 20px; top: 20px; font-size: 30px; opacity: 0.1;">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                    </div>
                </div>
                
                <!-- GR√ÅFICOS -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 30px 0;">
                    <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: var(--shadow);">
                        <h3 style="margin-bottom: 15px; color: var(--dark); font-size: 18px;">
                            <i class="fas fa-chart-pie"></i> Produtos Mais Vendidos
                        </h3>
                        <canvas id="flavorsChart" height="200"></canvas>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: var(--shadow);">
                        <h3 style="margin-bottom: 15px; color: var(--dark); font-size: 18px;">
                            <i class="fas fa-chart-line"></i> Evolu√ß√£o Semanal
                        </h3>
                        <canvas id="weeklyChart" height="200"></canvas>
                    </div>
                </div>
                
                <!-- DASHBOARD GRID -->
                <div class="dashboard-grid">
                    <!-- √öLTIMAS VENDAS -->
                    <div class="recent-sales-container">
                        <div class="sales-header">
                            <h3><i class="fas fa-history"></i> √öltimas Vendas</h3>
                            <button class="btn-primary" id="btnVerTodas" style="padding: 8px 15px; font-size: 12px;">
                                Ver Todas
                            </button>
                        </div>
                        <div id="recentSalesList" class="loading">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Carregando √∫ltimas vendas...</p>
                        </div>
                    </div>
                    
                    <!-- PRODUTOS MAIS VENDIDOS -->
                    <div class="top-products-container">
                        <div class="sales-header">
                            <h3><i class="fas fa-crown"></i> Top Produtos</h3>
                            <button class="btn-primary" id="btnVerTodosProdutos" style="padding: 8px 15px; font-size: 12px;">
                                Ver Todos
                            </button>
                        </div>
                        <div id="topProductsList" class="loading">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Carregando produtos...</p>
                        </div>
                    </div>
                </div>
                
                <!-- ESTOQUE BAIXO -->
                <div class="low-stock-container" id="lowStockContainer" style="display: none;">
                    <div class="sales-header">
                        <h3><i class="fas fa-exclamation-triangle"></i> Estoque Baixo</h3>
                        <button class="btn-primary" id="btnReporEstoque" style="padding: 8px 15px; font-size: 12px; background: var(--warning);">
                            Repor Estoque
                        </button>
                    </div>
                    <div id="lowStockList" class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Verificando estoque...</p>
                    </div>
                </div>
            </section>
            
            <!-- VENDAS -->
            <section id="vendas" class="page">
                <div class="page-title">
                    <i class="fas fa-cash-register"></i>
                    <h2>Vender Chop</h2>
                </div>
                
                <!-- PRODUTOS -->
                <div>
                    <h3 style="margin: 15px 0; color: var(--dark); font-size: 20px;">
                        <i class="fas fa-ice-cream"></i> Selecione os Produtos
                    </h3>
                    <div class="flavors-grid" id="productsGrid">
                        <div class="loading" style="grid-column: 1 / -1;">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Carregando produtos...</p>
                        </div>
                    </div>
                </div>
                
                <!-- CARRINHO -->
                <div class="cart-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: var(--dark); font-size: 22px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-shopping-cart"></i> Carrinho
                        </h3>
                        <button class="btn-primary" style="background: var(--danger); padding: 10px 20px; font-size: 14px;" id="clearCart">
                            <i class="fas fa-trash"></i> Limpar
                        </button>
                    </div>
                    
                    <div id="cartItems" style="max-height: 250px; overflow-y: auto; margin-bottom: 20px;">
                        <div class="loading">
                            <i class="fas fa-shopping-cart"></i>
                            <p>Selecione os produtos para come√ßar</p>
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin: 20px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 16px;">
                            <span>Total de Itens:</span>
                            <span id="totalItems">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 16px;">
                            <span>Valor Total:</span>
                            <span id="totalValue">R$ 0,00</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 24px; font-weight: 900; color: var(--dark); padding-top: 10px; border-top: 2px solid #dee2e6;">
                            <span>TOTAL:</span>
                            <span id="totalToPay">R$ 0,00</span>
                        </div>
                    </div>
                    
                    <!-- FORMAS DE PAGAMENTO -->
                    <div style="margin: 20px 0;">
                        <h4 style="margin-bottom: 15px; color: var(--dark); font-size: 18px;">
                            <i class="fas fa-credit-card"></i> Forma de Pagamento
                        </h4>
                        <div class="payment-options">
                            <label class="payment-option">
                                <input type="radio" name="payment" value="dinheiro" checked>
                                <div class="payment-card">
                                    <span class="payment-icon">üíµ</span>
                                    <div class="payment-name">Dinheiro</div>
                                </div>
                            </label>
                            
                            <label class="payment-option">
                                <input type="radio" name="payment" value="cartao">
                                <div class="payment-card">
                                    <span class="payment-icon">üí≥</span>
                                    <div class="payment-name">Cart√£o</div>
                                </div>
                            </label>
                            
                            <label class="payment-option">
                                <input type="radio" name="payment" value="pix">
                                <div class="payment-card">
                                    <span class="payment-icon">üì±</span>
                                    <div class="payment-name">PIX</div>
                                </div>
                            </label>
                            
                            <label class="payment-option">
                                <input type="radio" name="payment" value="fiado">
                                <div class="payment-card">
                                    <span class="payment-icon">üìù</span>
                                    <div class="payment-name">Fiado</div>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <button class="btn-primary" id="finalizeSale" disabled style="width: 100%;">
                        <i class="fas fa-check-circle"></i>
                        FINALIZAR VENDA
                    </button>
                </div>
            </section>
            
            <!-- PRODUTOS -->
            <section id="produtos" class="page">
                <div class="page-title">
                    <i class="fas fa-ice-cream"></i>
                    <h2>Gest√£o de Produtos</h2>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <p style="color: var(--gray); font-size: 16px;">
                        Cadastre e gerencie seus produtos
                    </p>
                    <button class="btn-primary" id="addProduct" style="padding: 12px 25px; font-size: 16px;">
                        <i class="fas fa-plus"></i>
                        Novo Produto
                    </button>
                </div>
                
                <!-- FILTROS DE PRODUTOS -->
                <div style="background: white; padding: 15px; border-radius: 15px; box-shadow: var(--shadow); margin-bottom: 20px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 700; color: var(--dark); font-size: 14px;">Filtrar por:</label>
                            <select id="productFilter" style="padding: 10px 15px; border: 2px solid #dee2e6; border-radius: 10px; font-size: 14px; min-width: 150px;">
                                <option value="todos">Todos os Produtos</option>
                                <option value="estoque-baixo">Estoque Baixo</option>
                                <option value="mais-vendidos">Mais Vendidos</option>
                                <option value="ativos">Ativos</option>
                                <option value="inativos">Inativos</option>
                            </select>
                        </div>
                        
                        <div style="flex: 1; min-width: 200px;">
                            <input type="text" id="productSearch" placeholder="Buscar produto..." style="width: 100%; padding: 10px 15px; border: 2px solid #dee2e6; border-radius: 10px; font-size: 14px;">
                        </div>
                    </div>
                </div>
                
                <div class="flavors-grid" id="productsList">
                    <div class="loading" style="grid-column: 1 / -1;">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Carregando produtos...</p>
                    </div>
                </div>
            </section>
            
            <!-- FIADOS -->
            <section id="fiados" class="page">
                <div class="page-title">
                    <i class="fas fa-hand-holding-usd"></i>
                    <h2>Controle de Fiados</h2>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <p style="color: var(--gray); font-size: 16px;">
                        Gerencie vendas fiadas e recebimentos
                    </p>
                    <button class="btn-primary" id="novoFiado" style="padding: 12px 25px; font-size: 16px;">
                        <i class="fas fa-plus"></i>
                        Novo Fiado
                    </button>
                </div>
                
                <!-- RESUMO DE FIADOS -->
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div style="font-size: 14px; color: var(--gray); margin-bottom: 10px;">Total a Receber</div>
                        <div style="font-size: 32px; font-weight: 900; color: var(--dark);" id="totalReceber">R$ 0,00</div>
                        <div style="position: absolute; right: 20px; top: 20px; font-size: 30px; opacity: 0.1;">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div style="font-size: 14px; color: var(--gray); margin-bottom: 10px;">Recebido M√™s</div>
                        <div style="font-size: 32px; font-weight: 900; color: var(--success);" id="recebidoMes">R$ 0,00</div>
                        <div style="position: absolute; right: 20px; top: 20px; font-size: 30px; opacity: 0.1;">
                            <i class="fas fa-cash-register"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div style="font-size: 14px; color: var(--gray); margin-bottom: 10px;">Clientes em Atraso</div>
                        <div style="font-size: 32px; font-weight: 900; color: var(--danger);" id="clientesAtraso">0</div>
                        <div style="position: absolute; right: 20px; top: 20px; font-size: 30px; opacity: 0.1;">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div style="font-size: 14px; color: var(--gray); margin-bottom: 10px;">Fiados Ativos</div>
                        <div style="font-size: 32px; font-weight: 900; color: var(--warning);" id="fiadosAtivos">0</div>
                        <div style="position: absolute; right: 20px; top: 20px; font-size: 30px; opacity: 0.1;">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                </div>
                
                <!-- FILTROS -->
                <div style="background: white; padding: 15px; border-radius: 15px; box-shadow: var(--shadow); margin-bottom: 20px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 700; color: var(--dark); font-size: 14px;">Status:</label>
                            <select id="filterStatus" style="padding: 10px 15px; border: 2px solid #dee2e6; border-radius: 10px; font-size: 14px; min-width: 150px;">
                                <option value="todos">Todos</option>
                                <option value="pendente">Pendentes</option>
                                <option value="atrasado">Em Atraso</option>
                                <option value="pago">Pagos</option>
                                <option value="parcial">Parcialmente Pagos</option>
                            </select>
                        </div>
                        
                        <div style="flex: 1; min-width: 200px;">
                            <input type="text" id="searchCliente" placeholder="Buscar cliente..." style="width: 100%; padding: 10px 15px; border: 2px solid #dee2e6; border-radius: 10px; font-size: 14px;">
                        </div>
                        
                        <button class="btn-primary" id="btnExportFiados" style="padding: 10px 20px; font-size: 14px;">
                            <i class="fas fa-file-export"></i> Exportar
                        </button>
                    </div>
                </div>
                
                <!-- LISTA DE FIADOS -->
                <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: var(--shadow);">
                    <div id="fiadosList" class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Carregando fiados...</p>
                    </div>
                </div>
            </section>
            
            <!-- RELAT√ìRIOS -->
            <section id="relatorios" class="page">
                <div class="page-title">
                    <i class="fas fa-chart-pie"></i>
                    <h2>Relat√≥rios e Exporta√ß√£o</h2>
                </div>
                
                <!-- FILTROS -->
                <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: var(--shadow); margin-bottom: 20px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 700; color: var(--dark); font-size: 14px;">Per√≠odo:</label>
                            <select id="reportPeriod" style="padding: 10px 15px; border: 2px solid #dee2e6; border-radius: 10px; font-size: 14px; min-width: 150px;">
                                <option value="hoje">Hoje</option>
                                <option value="ontem">Ontem</option>
                                <option value="semana">Esta Semana</option>
                                <option value="mes" selected>Este M√™s</option>
                                <option value="ano">Este Ano</option>
                                <option value="personalizado">Personalizado</option>
                            </select>
                        </div>
                        
                        <div id="customDateRange" style="display: none; flex: 1;">
                            <div style="display: flex; gap: 10px;">
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: 700; color: var(--dark); font-size: 14px;">De:</label>
                                    <input type="date" id="startDate" style="padding: 10px; border: 2px solid #dee2e6; border-radius: 10px; font-size: 14px; width: 100%;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; font-weight: 700; color: var(--dark); font-size: 14px;">At√©:</label>
                                    <input type="date" id="endDate" style="padding: 10px; border: 2px solid #dee2e6; border-radius: 10px; font-size: 14px; width: 100%;">
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-left: auto;">
                            <button class="btn-primary" id="generateReportBtn" style="font-size: 14px; padding: 10px 20px;">
                                <i class="fas fa-sync-alt"></i>
                                Gerar Relat√≥rio
                            </button>
                        </div>
                    </div>
                    
                    <!-- BOT√ïES DE EXPORTA√á√ÉO -->
                    <div class="export-buttons">
                        <button class="export-btn print" id="printReport">
                            <i class="fas fa-print"></i>
                            Imprimir Relat√≥rio
                        </button>
                    </div>
                </div>
                
                <!-- CONTE√öDO DO RELAT√ìRIO -->
                <div id="reportContent" style="background: white; padding: 20px; border-radius: 15px; box-shadow: var(--shadow);">
                    <div style="text-align: center; padding: 40px 20px; color: var(--gray);">
                        <i class="fas fa-chart-pie" style="font-size: 60px; margin-bottom: 15px; opacity: 0.3;"></i>
                        <p style="font-size: 16px;">Selecione um per√≠odo e clique em "Gerar Relat√≥rio"</p>
                    </div>
                </div>
            </section>
            
            <!-- CONFIGURA√á√ïES -->
            <section id="config" class="page">
                <div class="page-title">
                    <i class="fas fa-cog"></i>
                    <h2>Configura√ß√µes do Sistema</h2>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                    <!-- BACKUP -->
                    <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: var(--shadow);">
                        <h3 style="margin-bottom: 15px; color: var(--dark); font-size: 18px;">
                            <i class="fas fa-database"></i> Backup de Dados
                        </h3>
                        <p style="color: var(--gray); margin-bottom: 20px; font-size: 14px;">
                            Fa√ßa backup de todos os dados do sistema.
                        </p>
                        <button class="btn-primary" id="backupBtn" style="width: 100%; padding: 12px;">
                            <i class="fas fa-save"></i>
                            Fazer Backup
                        </button>
                    </div>
                    
                    <!-- INFORMA√á√ïES -->
                    <div style="background: white; padding: 20px; border-radius: 15px; box-shadow: var(--shadow);">
                        <h3 style="margin-bottom: 15px; color: var(--dark); font-size: 18px;">
                            <i class="fas fa-info-circle"></i> Informa√ß√µes do Sistema
                        </h3>
                        <div style="color: var(--gray); font-size: 14px;">
                            <p><strong>Vers√£o:</strong> Chop Manager PRO 2.1</p>
                            <p><strong>Produtos:</strong> <span id="totalProducts">0</span></p>
                            <p><strong>Vendas:</strong> <span id="totalSales">0</span></p>
                            <p><strong>Faturamento Total:</strong> <span id="totalRevenue">R$ 0,00</span></p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        
        <!-- FOOTER -->
        <footer class="footer">
            <p>üç¶ Sistema Chop Manager PRO - Vers√£o 2.1</p>
            <p style="margin-top: 8px; font-size: 12px; opacity: 0.8;">
                Sistema completo para gest√£o de vendas de sorvete
            </p>
        </footer>
    </div>
    
    <!-- MODAL DE PRODUTO -->
    <div class="modal-overlay" id="productModal">
        <div class="modal">
            <div style="padding: 20px; background: linear-gradient(135deg, var(--primary), #2A9D8F); color: white; border-radius: 15px 15px 0 0;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="font-size: 22px; font-weight: 800; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-ice-cream"></i>
                        <span id="modalTitle">Novo Produto</span>
                    </div>
                    <button id="closeModal" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">
                        &times;
                    </button>
                </div>
            </div>
            
            <div style="padding: 20px;">
                <form id="productForm">
                    <input type="hidden" id="productId">
                    
                    <!-- FOTO DO PRODUTO -->
                    <div class="form-group">
                        <label class="form-label">Foto do Produto (opcional)</label>
                        <div class="photo-upload-container" id="photoUploadContainer">
                            <div class="upload-icon">
                                <i class="fas fa-camera"></i>
                            </div>
                            <p style="color: var(--gray); margin-bottom: 8px; font-size: 14px;">Clique para adicionar uma foto</p>
                            <p style="font-size: 12px; color: var(--gray);">Formatos: JPG, PNG (max. 2MB)</p>
                            <img id="photoPreview" class="photo-preview" alt="Preview da foto">
                        </div>
                        <input type="file" id="productPhoto" accept="image/*" style="display: none;">
                        <input type="hidden" id="productPhotoData">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Nome do Produto *</label>
                        <input type="text" id="productName" class="form-input" placeholder="Ex: Casquinha de Chocolate" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Descri√ß√£o</label>
                        <textarea id="productDescription" class="form-input" rows="2" placeholder="Descreva o produto..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Pre√ßo (R$) *</label>
                        <input type="number" id="productPrice" class="form-input" step="0.01" min="0" placeholder="5.00" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Estoque Inicial *</label>
                        <input type="number" id="productStock" class="form-input" min="0" placeholder="100" required>
                    </div>
                    
                    <!-- PERSONALIZA√á√ÉO DE EMOJI -->
                    <div class="form-group">
                        <label class="form-label">Emoji do Produto</label>
                        <div class="emoji-selected" id="emojiSelector">
                            <span id="selectedEmoji">üç¶</span>
                            <span style="color: var(--gray); font-size: 14px;">Clique para escolher um emoji</span>
                        </div>
                        <div class="emoji-picker" id="emojiPicker">
                            <!-- Emojis ser√£o inseridos por JavaScript -->
                        </div>
                        <input type="hidden" id="productEmoji" value="üç¶">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Cor de Identifica√ß√£o</label>
                        <input type="color" id="productColor" value="#36B5B0" style="width: 100%; height: 40px; border-radius: 10px; border: 2px solid #dee2e6; cursor: pointer;">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" style="display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="productActive" checked style="width: 20px; height: 20px;">
                            <span>Produto Ativo</span>
                        </label>
                    </div>
                </form>
            </div>
            
            <div style="padding: 15px 20px; border-top: 2px solid #f0f0f0; display: flex; justify-content: flex-end; gap: 10px;">
                <button class="btn-primary" id="cancelModal" style="background: var(--gray); padding: 10px 20px;">
                    Cancelar
                </button>
                <button class="btn-primary" id="saveProduct" style="padding: 10px 20px;">
                    Salvar Produto
                </button>
            </div>
        </div>
    </div>
    
    <!-- MODAL FIADO -->
    <div class="modal-overlay" id="fiadoModal">
        <div class="modal" style="max-width: 600px;">
            <div style="padding: 20px; background: linear-gradient(135deg, #FF7BAC, #FF4081); color: white; border-radius: 15px 15px 0 0;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="font-size: 22px; font-weight: 800; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-hand-holding-usd"></i>
                        <span id="modalFiadoTitle">Novo Fiado</span>
                    </div>
                    <button id="closeFiadoModal" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">
                        &times;
                    </button>
                </div>
            </div>
            
            <div style="padding: 20px;">
                <form id="fiadoForm">
                    <input type="hidden" id="fiadoIndex">
                    
                    <div class="form-group">
                        <label class="form-label">Nome do Cliente *</label>
                        <input type="text" id="nomeCliente" class="form-input" placeholder="Nome completo" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Telefone</label>
                        <input type="text" id="telefoneCliente" class="form-input" placeholder="(11) 99999-9999">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Produtos *</label>
                        <div id="produtosFiadoContainer">
                            <!-- Produtos ser√£o adicionados dinamicamente -->
                        </div>
                        <button type="button" class="btn-primary" id="addProdutoFiado" style="margin-top: 10px; padding: 8px 15px; font-size: 14px;">
                            <i class="fas fa-plus"></i> Adicionar Produto
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Prazo de Pagamento *</label>
                        <input type="date" id="prazoPagamento" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Data de Retirada</label>
                        <input type="date" id="dataRetirada" class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Valor Pago Inicial (se houver)</label>
                        <input type="number" id="valorPago" class="form-input" step="0.01" min="0" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes</label>
                        <textarea id="observacoes" class="form-input" rows="3" placeholder="Observa√ß√µes importantes..."></textarea>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: 700;">
                            <span>Total:</span>
                            <span id="fiadoTotal">R$ 0,00</span>
                        </div>
                    </div>
                </form>
            </div>
            
            <div style="padding: 15px 20px; border-top: 2px solid #f0f0f0; display: flex; justify-content: flex-end; gap: 10px;">
                <button class="btn-primary" id="cancelFiadoModal" style="background: var(--gray); padding: 10px 20px;">
                    Cancelar
                </button>
                <button class="btn-primary" id="saveFiado" style="padding: 10px 20px;">
                    Salvar Fiado
                </button>
            </div>
        </div>
    </div>
    
    <!-- MODAL PAGAMENTO FIADO -->
    <div class="modal-overlay" id="pagamentoModal">
        <div class="modal" style="max-width: 500px;">
            <div style="padding: 20px; background: linear-gradient(135deg, #4CAF50, #2E7D32); color: white; border-radius: 15px 15px 0 0;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="font-size: 22px; font-weight: 800; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Registrar Pagamento</span>
                    </div>
                    <button onclick="fecharPagamentoModal()" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">
                        &times;
                    </button>
                </div>
            </div>
            
            <div style="padding: 20px;">
                <div id="pagamentoInfo" style="margin-bottom: 20px;"></div>
                
                <div class="form-group">
                    <label class="form-label">Valor do Pagamento *</label>
                    <input type="number" id="valorPagamento" class="form-input" step="0.01" min="0" placeholder="0.00" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Data do Pagamento</label>
                    <input type="date" id="dataPagamento" class="form-input">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Forma de Pagamento</label>
                    <select id="formaPagamento" class="form-input">
                        <option value="dinheiro">Dinheiro</option>
                        <option value="pix">PIX</option>
                        <option value="cartao">Cart√£o</option>
                        <option value="transferencia">Transfer√™ncia</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea id="obsPagamento" class="form-input" rows="2" placeholder="Observa√ß√µes sobre o pagamento..."></textarea>
                </div>
            </div>
            
            <div style="padding: 15px 20px; border-top: 2px solid #f0f0f0; display: flex; justify-content: flex-end; gap: 10px;">
                <button class="btn-primary" onclick="fecharPagamentoModal()" style="background: var(--gray); padding: 10px 20px;">
                    Cancelar
                </button>
                <button class="btn-primary" onclick="confirmarPagamento()" style="padding: 10px 20px;">
                    Registrar Pagamento
                </button>
            </div>
        </div>
    </div>
    
    <!-- NOTIFICA√á√ïES -->
    <div class="notification" id="notification"></div>
<script>
<script>
/* =========================================================
   MINI CRM COMPLETO ‚Äì CHOP MANAGER PRO
   BLOCO 1/4 ‚Äî CORE DO SISTEMA
========================================================= */

const API_URL = 'https://helbertbarbosa07-vendaschopp.vercel.app/api/neon';

let produtos = [];
let carrinho = [];
let fiados = [];
let charts = {};
let isLoading = false;

/* =======================
   API BASE
======================= */
async function neonAPI(action, data = null) {
    const res = await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action, data })
    });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const json = await res.json();
    if (!json.success) throw new Error(json.error || 'Erro API');
    return json.data;
}

/* =======================
   UTILIT√ÅRIOS
======================= */
function formatPrice(v) {
    return Number(v || 0).toFixed(2).replace('.', ',');
}

function notify(msg, type = 'info') {
    const n = document.getElementById('notification');
    n.textContent = msg;
    n.className = `notification ${type} show`;
    setTimeout(() => n.classList.remove('show'), 3000);
}

function updateClock() {
    const now = new Date();
    document.getElementById('currentDate').textContent =
        now.toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric' });
    document.getElementById('currentTime').textContent =
        now.toLocaleTimeString('pt-BR');
}

/* =======================
   INIT
======================= */
document.addEventListener('DOMContentLoaded', async () => {
    updateClock();
    setInterval(updateClock, 1000);

    setupNavigation();
    setupEvents();
    await syncData();
});

/* =======================
   NAVEGA√á√ÉO
======================= */
function setupNavigation() {
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.onclick = () => {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(tab.dataset.page).classList.add('active');

            if (tab.dataset.page === 'dashboard') loadDashboard();
            if (tab.dataset.page === 'vendas') loadProductsForSale();
            if (tab.dataset.page === 'produtos') loadProductsList();
            if (tab.dataset.page === 'fiados') loadFiados();
            if (tab.dataset.page === 'relatorios') loadReports();
            if (tab.dataset.page === 'config') loadConfig();
        };
    });
}

/* =======================
   EVENTOS
======================= */
function setupEvents() {
    document.getElementById('finalizeSale').onclick = finalizeSale;
    document.getElementById('clearCart').onclick = clearCart;
    document.getElementById('syncButton').onclick = syncData;
    document.getElementById('backupBtn').onclick = backupData;
}

/* =======================
   SYNC GLOBAL
======================= */
async function syncData() {
    try {
        produtos = await neonAPI('get_produtos');
        await loadDashboard();
        await loadProductsForSale();
        await loadProductsList();
        notify('Sistema sincronizado', 'success');
    } catch {
        notify('Erro ao sincronizar', 'error');
    }
}

/* =======================
   DASHBOARD
======================= */
async function loadDashboard() {
    const stats = await neonAPI('get_dashboard_stats');
    document.getElementById('todayRevenue').textContent = `R$ ${formatPrice(stats.faturamentoHoje)}`;
    document.getElementById('todayChops').textContent = stats.totalItens || 0;
    document.getElementById('avgSale').textContent =
        `R$ ${formatPrice(stats.totalVendas ? stats.faturamentoHoje / stats.totalVendas : 0)}`;
    document.getElementById('lowStock').textContent = stats.estoqueBaixo || 0;
}

/* =======================
   PRODUTOS (VENDA)
======================= */
async function loadProductsForSale() {
    produtos = await neonAPI('get_produtos');
    const grid = document.getElementById('productsGrid');
    const ativos = produtos.filter(p => p.ativo && p.estoque > 0);

    grid.innerHTML = ativos.length
        ? ativos.map(p => `
            <div class="flavor-card" onclick="addToCart(${p.id})">
                <div style="font-size:40px">${p.emoji || 'üç¶'}</div>
                <h3>${p.nome}</h3>
                <strong>R$ ${formatPrice(p.preco)}</strong>
                <div>Estoque: ${p.estoque}</div>
            </div>`).join('')
        : '<p>Nenhum produto dispon√≠vel</p>';
}

/* =======================
   PRODUTOS (LISTA)
======================= */
async function loadProductsList() {
    const list = document.getElementById('productsList');
    produtos = await neonAPI('get_produtos');
    list.innerHTML = produtos.map(p => `
        <div class="flavor-card">
            <strong>${p.nome}</strong><br>
            R$ ${formatPrice(p.preco)}<br>
            Estoque: ${p.estoque}
        </div>`).join('');
}

/* =======================
   CARRINHO
======================= */
window.addToCart = function(id) {
    const p = produtos.find(x => x.id === id);
    if (!p || p.estoque <= 0) return;

    const item = carrinho.find(i => i.produtoId === id);
    if (item) {
        if (item.quantidade >= p.estoque) return;
        item.quantidade++;
        item.total = item.quantidade * item.preco;
    } else {
        carrinho.push({
            produtoId: id,
            nome: p.nome,
            emoji: p.emoji || 'üç¶',
            preco: p.preco,
            quantidade: 1,
            total: p.preco
        });
    }
    updateCart();
};

function updateCart() {
    const el = document.getElementById('cartItems');
    const total = carrinho.reduce((s, i) => s + i.total, 0);

    document.getElementById('totalItems').textContent =
        carrinho.reduce((s, i) => s + i.quantidade, 0);
    document.getElementById('totalValue').textContent = `R$ ${formatPrice(total)}`;
    document.getElementById('totalToPay').textContent = `R$ ${formatPrice(total)}`;
    document.getElementById('finalizeSale').disabled = carrinho.length === 0;

    el.innerHTML = carrinho.length
        ? carrinho.map((i, idx) => `
            <div>
                ${i.emoji} ${i.nome} x${i.quantidade}
                <strong>R$ ${formatPrice(i.total)}</strong>
                <button onclick="removeCartItem(${idx})">üóë</button>
            </div>`).join('')
        : '<p>Carrinho vazio</p>';
}

window.removeCartItem = i => {
    carrinho.splice(i, 1);
    updateCart();
};

function clearCart() {
    carrinho = [];
    updateCart();
}

/* =======================
   FINALIZAR VENDA
======================= */
async function finalizeSale() {
    if (isLoading || !carrinho.length) return;
    isLoading = true;

    try {
        const pagamento =
            document.querySelector('input[name="payment"]:checked')?.value || 'dinheiro';

        if (pagamento === 'fiado') {
            openFiadoFromCart();
            return;
        }

        const venda = {
            data: new Date().toISOString().split('T')[0],
            hora: new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }),
            pagamento,
            total: carrinho.reduce((s, i) => s + i.total, 0),
            itens: carrinho.map(i => ({
                produtoId: i.produtoId,
                quantidade: i.quantidade,
                preco: i.preco
            }))
        };

        await neonAPI('create_venda', venda);
        carrinho = [];
        updateCart();
        await syncData();
        notify('Venda realizada com sucesso', 'success');
    } catch {
        notify('Erro ao finalizar venda', 'error');
    } finally {
        isLoading = false;
    }
}
/* =========================================================
   BLOCO 2/4 ‚Äî FIADOS (CRM REAL)
========================================================= */

/* =======================
   ABRIR FIADO PELO CARRINHO
======================= */
function openFiadoFromCart() {
    if (!carrinho.length) return;
    document.getElementById('fiadoModal').classList.add('active');

    document.getElementById('produtosFiadoContainer').innerHTML =
        carrinho.map((i, idx) => `
            <div style="margin-bottom:8px;">
                ${i.nome} x${i.quantidade} ‚Äî R$ ${formatPrice(i.total)}
                <input type="hidden" data-idx="${idx}">
            </div>
        `).join('');

    updateFiadoTotal();
}

/* =======================
   CALCULAR TOTAL FIADO
======================= */
function updateFiadoTotal() {
    const total = carrinho.reduce((s, i) => s + i.total, 0);
    document.getElementById('fiadoTotal').textContent = `R$ ${formatPrice(total)}`;
}

/* =======================
   SALVAR FIADO
======================= */
document.getElementById('saveFiado').onclick = async () => {
    const nome = document.getElementById('nomeCliente').value.trim();
    const telefone = document.getElementById('telefoneCliente').value.trim();
    const prazo = document.getElementById('prazoPagamento').value;
    const pago = Number(document.getElementById('valorPago').value || 0);

    if (!nome || !prazo) {
        notify('Preencha os dados obrigat√≥rios', 'error');
        return;
    }

    const total = carrinho.reduce((s, i) => s + i.total, 0);

    const fiado = {
        cliente: nome,
        telefone,
        data: new Date().toISOString().split('T')[0],
        prazo,
        total,
        pago,
        status: pago >= total ? 'pago' : 'pendente',
        itens: carrinho.map(i => ({
            produtoId: i.produtoId,
            quantidade: i.quantidade,
            preco: i.preco
        }))
    };

    try {
        await neonAPI('create_fiado', fiado);
        carrinho = [];
        updateCart();
        document.getElementById('fiadoModal').classList.remove('active');
        await loadFiados();
        notify('Fiado registrado com sucesso', 'success');
    } catch {
        notify('Erro ao salvar fiado', 'error');
    }
};

/* =======================
   LISTAR FIADOS
======================= */
async function loadFiados() {
    fiados = await neonAPI('get_fiados');
    const list = document.getElementById('fiadosList');

    if (!fiados.length) {
        list.innerHTML = '<p>Nenhum fiado registrado</p>';
        return;
    }

    list.innerHTML = fiados.map((f, idx) => `
        <div class="flavor-card">
            <strong>${f.cliente}</strong><br>
            Total: R$ ${formatPrice(f.total)}<br>
            Pago: R$ ${formatPrice(f.pago)}<br>
            Status: <strong>${f.status}</strong><br>
            <button onclick="openPagamento(${idx})">Registrar Pagamento</button>
        </div>
    `).join('');
}

/* =======================
   PAGAMENTO DE FIADO
======================= */
let fiadoAtual = null;

function openPagamento(idx) {
    fiadoAtual = fiados[idx];
    document.getElementById('pagamentoModal').classList.add('active');
    document.getElementById('pagamentoInfo').innerHTML =
        `<strong>${fiadoAtual.cliente}</strong><br>
         Restante: R$ ${formatPrice(fiadoAtual.total - fiadoAtual.pago)}`;
}

function fecharPagamentoModal() {
    document.getElementById('pagamentoModal').classList.remove('active');
}

/* =======================
   CONFIRMAR PAGAMENTO
======================= */
async function confirmarPagamento() {
    const valor = Number(document.getElementById('valorPagamento').value || 0);
    if (valor <= 0) {
        notify('Valor inv√°lido', 'error');
        return;
    }

    try {
        await neonAPI('pay_fiado', {
            id: fiadoAtual.id,
            valor
        });

        fecharPagamentoModal();
        await loadFiados();
        notify('Pagamento registrado', 'success');
    } catch {
        notify('Erro ao registrar pagamento', 'error');
    }
}
/* =========================================================
   BLOCO 3/4 ‚Äî RELAT√ìRIOS + GR√ÅFICOS
========================================================= */

/* =======================
   RELAT√ìRIOS
======================= */
async function loadReports() {
    document.getElementById('reportContent').innerHTML =
        '<p style="text-align:center">Clique em "Gerar Relat√≥rio"</p>';
}

/* =======================
   GERAR RELAT√ìRIO
======================= */
document.getElementById('generateReportBtn').onclick = async () => {
    const period = document.getElementById('reportPeriod').value;

    const data = await neonAPI('get_relatorio', { period });

    renderReport(data);
    renderCharts(data);
};

/* =======================
   RENDER RELAT√ìRIO
======================= */
function renderReport(data) {
    document.getElementById('reportContent').innerHTML = `
        <h3>Resumo do Per√≠odo</h3>
        <p><strong>Total de Vendas:</strong> ${data.totalVendas}</p>
        <p><strong>Faturamento:</strong> R$ ${formatPrice(data.faturamento)}</p>
        <p><strong>Itens Vendidos:</strong> ${data.itens}</p>
    `;
}

/* =======================
   GR√ÅFICOS
======================= */
function renderCharts(data) {
    if (charts.flavors) charts.flavors.destroy();
    if (charts.weekly) charts.weekly.destroy();

    const ctx1 = document.getElementById('flavorsChart').getContext('2d');
    charts.flavors = new Chart(ctx1, {
        type: 'pie',
        data: {
            labels: data.produtos.map(p => p.nome),
            datasets: [{
                data: data.produtos.map(p => p.qtd)
            }]
        }
    });

    const ctx2 = document.getElementById('weeklyChart').getContext('2d');
    charts.weekly = new Chart(ctx2, {
        type: 'line',
        data: {
            labels: data.semana.map(d => d.dia),
            datasets: [{
                label: 'Faturamento',
                data: data.semana.map(d => d.total),
                fill: false
            }]
        }
    });
}

/* =======================
   IMPRIMIR RELAT√ìRIO
======================= */
document.getElementById('printReport').onclick = () => {
    window.print();
};
/* =========================================================
   BLOCO 4/4 ‚Äî BACKUP + CONFIG + FECHAMENTO
========================================================= */

/* =======================
   BACKUP COMPLETO (JSON)
======================= */
async function backupData() {
    try {
        const backup = {
            data_backup: new Date().toISOString(),
            produtos: await neonAPI('get_produtos'),
            fiados: await neonAPI('get_fiados'),
            vendas: await neonAPI('get_vendas')
        };

        const blob = new Blob(
            [JSON.stringify(backup, null, 2)],
            { type: 'application/json' }
        );

        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `backup_crm_${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);

        notify('Backup gerado com sucesso', 'success');
    } catch (e) {
        notify('Erro ao gerar backup', 'error');
    }
}

/* =======================
   CONFIGURA√á√ïES
======================= */
function loadConfig() {
    document.getElementById('totalProducts').textContent = produtos.length || 0;
}

/* =======================
   FECHAR MODAIS (GEN√âRICO)
======================= */
document.querySelectorAll('#closeModal, #cancelModal').forEach(btn => {
    if (btn) btn.onclick = () =>
        document.getElementById('productModal').classList.remove('active');
});

document.querySelectorAll('#closeFiadoModal, #cancelFiadoModal').forEach(btn => {
    if (btn) btn.onclick = () =>
        document.getElementById('fiadoModal').classList.remove('active');
});

/* =======================
   SEGURAN√áA B√ÅSICA
======================= */
window.onerror = function () {
    notify('Erro inesperado no sistema', 'error');
    return true;
};

/* =======================
   FIM DO SCRIPT
======================= */
console.log('Mini CRM Chop Manager PRO carregado com sucesso');
</script>

</script>
</body>
</html> 
