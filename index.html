-- Criar tabela de produtos
CREATE TABLE IF NOT EXISTS produtos (
    id BIGSERIAL PRIMARY KEY,
    nome TEXT NOT NULL,
    descricao TEXT,
    preco DECIMAL(10,2) NOT NULL DEFAULT 0,
    estoque INTEGER DEFAULT 0,
    emoji TEXT DEFAULT 'üç¶',
    cor TEXT DEFAULT '#36B5B0',
    categoria TEXT,
    foto TEXT,
    ativo BOOLEAN DEFAULT true,
    vendas INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW()),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

-- Criar tabela de vendas
CREATE TABLE IF NOT EXISTS vendas (
    id BIGSERIAL PRIMARY KEY,
    data DATE DEFAULT CURRENT_DATE,
    hora TIME DEFAULT CURRENT_TIME,
    itens JSONB NOT NULL,
    total DECIMAL(10,2) NOT NULL,
    pagamento TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

-- Criar tabela de configura√ß√µes
CREATE TABLE IF NOT EXISTS configuracoes (
    chave TEXT PRIMARY KEY,
    valor TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc', NOW())
);

-- Habilitar Row Level Security
ALTER TABLE produtos ENABLE ROW LEVEL SECURITY;
ALTER TABLE vendas ENABLE ROW LEVEL SECURITY;
ALTER TABLE configuracoes ENABLE ROW LEVEL SECURITY;

-- Criar pol√≠ticas para permitir todas as opera√ß√µes
CREATE POLICY "Allow all operations on produtos" ON produtos
    FOR ALL USING (true) WITH CHECK (true);

CREATE POLICY "Allow all operations on vendas" ON vendas
    FOR ALL USING (true) WITH CHECK (true);

CREATE POLICY "Allow all operations on configuracoes" ON configuracoes
    FOR ALL USING (true) WITH CHECK (true);
